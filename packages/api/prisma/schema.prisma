generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  extensions = [vector]
}

model Project {
  id            String            @id @default(cuid())
  name          String
  description   String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  conversations Conversation[]
  documents     ContextDocument[]
}

model Conversation {
  id        String    @id @default(cuid())
  title     String
  domainId  String
  projectId String
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([projectId])
  @@index([domainId])
}

model Message {
  id             String                        @id @default(cuid())
  conversationId String
  conversation   Conversation                  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role           String
  content        String
  embedding      Unsupported("vector(1536)")?
  createdAt      DateTime                      @default(now())

  @@index([conversationId])
}

model ContextDocument {
  id         String                        @id @default(cuid())
  name       String
  type       String
  size       String
  content    String?
  domainId   String
  projectId  String
  project    Project                       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  embedding  Unsupported("vector(1536)")?
  uploadedAt DateTime                      @default(now())

  @@index([projectId])
  @@index([domainId])
}
